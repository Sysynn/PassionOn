<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Passion On</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
  <body>
    <div class="sample">
    </div>
    <div class="container mt-3 col-8">
      <div class="row d-flex align-items-center justify-content-center">
        <div class="col-md-6 p-0">
          <div class="text-center my_content border border-dark">
            <div class="col">
              상품사진
            </div>
          </div>
        </div>
        <div class="col-sm-12 col-md-4">
          <div class="row">
            <div class="col border border-dark">
              <p class="small text-body-secondary">[ 브랜드 ]</p>                          
              <p>상품명</p>
              <p>가격</p>
              <p>사이즈</p>
              <p>색상</p>
              <p>수량</p>
              <div class="d-flex align-items-center">
              <button class="btn btn-outline-primary btn-sm me-2" onclick="decrease()">-</button>
              <input class="me-2" type="number" id="numInput" value="1" min="1" oninput="checkValue(); updateTotal();" style="width: 50px;">
              <button class="btn btn-outline-primary btn-sm" onclick="increase()">+</button></div>
              <p id="totalAmount">총 상품 금액</p>
              {% comment %} 가격을 숫자로 하면 00,000원 으로 나옴 {% endcomment %}
              <div class="row text-center">
                <div class="d-flex justify-content-center">
                  <div class="row mb-3">
                    {% if user.is_authenticated %}
                      <div class="col-12">
                        <form action="{% url 'likes' product.pk %}">
                          {% csrf_token %}
                          {% if request.user in product.like_users.all %}
                            <button class="fw-bold btn btn-warning">
                              찜 <i class="bi bi-heart-fill text-danger"></i>
                              <span class="like-count ms-2">{{ product.like_users.count }}</span>
                            </button>
                          {% else %}
                            <button class="fw-bold btn btn-warning">
                              찜 <i class="bi bi-heart text-danger"></i>
                              <span class="like-count ms-2">{{ product.like_users.count }}</span>
                            </button>
                          {% endif %} 
                        </form>
                      </div>
                    {% else %}                        
                    <button class="btn btn-warning" disabled="">
                      <b class="text-dark">찜</b><svg class="mx-1 text-danger" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                        <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                      </svg>
                      <span class="like-count">{{ product.like_users.count }}</span>
                    </button>
                    {% endif %}
                    <button type="button" class="col-6 btn btn-info">장바구니</button>
                    <button type="button" class="col-6 btn btn-primary">바로결제</button>
                      
                    </div>
                  </div>  
                </div>
              </div>
            </div>
          </div>
        </div>
        <ul class="nav nav-tabs mt-4">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">상세정보</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">후기</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">상품문의</a>
          </li>          
        </ul>
        <div id='review'>후기</div>
        <div id='QNA'>상품문의</div>
        </div>
      </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script>
      function decrease() {
        var input = document.getElementById('numInput');
        if (input.value > 1) {
          input.value--;
          updateTotal();
        }
      }
      
      function increase() {
        var input = document.getElementById('numInput');
        input.value++;
        updateTotal();
      }
      
      function checkValue() {
        var input = document.getElementById('numInput');
        if (input.value < 1) {
          input.value = 1;
        }
      }
      
      function updateTotal() {
        var input = document.getElementById('numInput');
        var price = parseFloat('{{ product.price }}');
        var total = price * parseFloat(input.value);
        document.getElementById('totalAmount').innerHTML = "총 상품금액 " + total.toLocaleString('ko-KR') + "원";
      }      
    </script>
  </body>
</html>
